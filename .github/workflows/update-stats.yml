name: Update NFL Stats

on:
  workflow_dispatch:  # This allows you to run it manually
  schedule:
    - cron: '0 2 * * MON'  # Optional: runs every Monday at 2am UTC

jobs:
  update-stats:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up R
        uses: r-lib/actions/setup-r@v2
        with:
          r-version: '4.3'  # Adjust if you want a different R version

      - name: Install R package dependencies
        run: |
          # Install remotes to get packages from GitHub
          Rscript -e "install.packages('remotes', repos='https://cloud.r-project.org')"

          # Install core packages your script might use
          Rscript -e "install.packages(c('dplyr','readr','jsonlite','lubridate'), repos='https://cloud.r-project.org')"

          # Install nflfastR from GitHub
          Rscript -e "remotes::install_github('nflverse/nflfastR', dependencies=TRUE)"

      - name: Generate weekly_stats.json
        run: |
          Rscript scripts/generate_weekly_stats.R
          
      - name: Commit JSON
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add weekly_stats.json
          git commit -m "Update NFL weekly stats" || echo "No changes to commit"
          git push
