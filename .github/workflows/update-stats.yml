name: Update NFL Stats

on:
  schedule:
    - cron: "0 12 * * TUE"   # Every Tuesday at 6 AM CST (12 UTC)
  workflow_dispatch:          # Allow manual run

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Set up R
        uses: r-lib/actions/setup-r@v2

      - name: Install nflfastR
        run: |
          R -e "install.packages('remotes')"
          R -e "remotes::install_github('nflverse/nflfastR')"
          R -e "install.packages('jsonlite')"

      - name: Download stats & export JSON
        run: |
          R - <<EOF
          library(nflfastR)
          library(jsonlite)
          
          season <- 2024  # CHANGE THIS TO YOUR ACTIVE SEASON YEAR
          stats <- load_player_stats(seasons = season)
          
          # Convert list to JSON file
          json <- toJSON(stats, pretty = TRUE, auto_unbox = TRUE)
          
          # Save into repo folder
          write(json, file = "weekly_stats.json")
          EOF

      - name: Commit and push stats
        run: |
          git config --global user.email "github-actions@github.com"
          git config --global user.name "GitHub Actions"
          git add weekly_stats.json
          git commit -m "Updated weekly NFL stats" || echo "No changes"
          git push
